services:
  chrome:
    image: browserless/chrome:latest
    restart: unless-stopped
    environment:
      - CONNECTION_TIMEOUT=600000
      - MAX_CONCURRENT_SESSIONS=10
      - ENABLE_DEBUGGER=true
      - PREBOOT_CHROME=true
      - KEEP_ALIVE=true
    ports:
      - "9222:3000"
    shm_size: 2gb

  backend:
    build:
      context: .
      dockerfile: Dockerfile-go
    restart: unless-stopped
    environment:
      - BROWSER_MODE=cdp
      - CDP_URL=http://chrome:3000
      - HOST=0.0.0.0
      - PORT=8000
    ports:
      - "8000:8000"
    volumes:
      - ./cache:/app/cache
    depends_on:
      - chrome

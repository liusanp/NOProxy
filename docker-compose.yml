services:
  chrome:
    image: browserless/chrome:latest
    restart: unless-stopped
    environment:
      - TIMEOUT=600000
      - HOST=0.0.0.0
      - TZ=Asia/Shanghai
      - HEALTH=true
      - MAX_MEMORY_PERCENT=80
      - MAX_CPU_PERCENT=80
    ports:
      - "9222:3000"
    shm_size: 2gb

  backend:
    build: .
    restart: unless-stopped
    environment:
      - BROWSER_MODE=cdp
      - CDP_URL=http://chrome:3000
      - BROWSER_PROXY=${BROWSER_PROXY:-}
    ports:
      - "8000:8000"
    volumes:
      - ./cache:/app/cache
    depends_on:
      - chrome
